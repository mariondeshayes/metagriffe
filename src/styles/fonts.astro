---
let QUERY, URL;

//FETCH PAGE, CAT CONTENT
QUERY = encodeURIComponent(`*[_type == "global"]{font}`);
// Compose the URL for your project's endpoint and add the query
URL = `https://${
  import.meta.env.PROJECT_ID
}.api.sanity.io/v2021-10-21/data/query/${
  import.meta.env.DATASET
}?query=${QUERY}`;
// fetch the content, global is a singleton document so take the first element of the array only
let data = await fetch(URL)
  .then((res) => res.json())
  .then(({ result }) => {
    return result[0];
  })
  .catch((err) => console.error(err));

//Get the names of the fonts
let tmp = data.font.split("font-family: ");
tmp.shift();
let fontFamilies = [];
for (let i = 0; i < tmp.length; i++) {
  fontFamilies.push(tmp[i].split(";")[0]);
}

//Generate the css
let css = `body{font-family: ${fontFamilies[0]}}\n`;
css += `.font1{font-family: ${fontFamilies[0]}}`;
if (fontFamilies.length > 1) {
  css += `h1,h2,h3,h4,h5,h6{font-family: ${fontFamilies[1]}}`;
  css += `.font2{font-family: ${fontFamilies[1]}}`;
} else {
  css += `h1,h2,h3,h4,h5,h6{font-family: ${fontFamilies[0]}}`;
  css += `.font2{font-family: ${fontFamilies[0]}}`;
}
---

<style set:html={data.font}></style>
<style set:html={css}></style>
