---
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const { seo } = Astro.props;

let QUERY, URLQUERY;

//FETCH THEME COLOR FROM GLOBAL
QUERY = encodeURIComponent(
  '*[_type == "global"]{themeColor{hex},titleExtension,"ogImageFallback":ogImageFallback.asset->url}',
);
// Compose the URL for your project's endpoint and add the query
URLQUERY = `https://${
  import.meta.env.PROJECT_ID
}.api.sanity.io/v2021-10-21/data/query/${
  import.meta.env.DATASET
}?query=${QUERY}`;
// fetch the content
let data = await fetch(URLQUERY)
  .then((res) => res.json())
  .then(({ result }) => {
    return result[0];
  })
  .catch((err) => console.error(err));

if (seo.canonical === null) {
  seo.canonical = canonicalURL;
}
---

<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content={data.themeColor.hex} />
  <!-- ðŸ¤” // need some limiting for scaling ? impact on a11y -->
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=5"
  />
  <link rel="canonical" href={canonicalURL} />
  <title>{seo.title}{data.titleExtension}</title>
  <meta name="description" content={seo.description} />

  <meta name="robots" content={seo.robots} />

  {seo.next && <link rel="next" href={seo.next} />}
  {seo.prev && <link rel="prev" href={seo.prev} />}

  <!-- ðŸŽ… // This is the only OG block of the site. We need more control on this. -->
  <meta name="og:title" content={seo.title} />
  <meta name="og:description" content={seo.description} />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content={import.meta.env.PUBLIC_SITENAME} />
  <meta property="og:image" content={seo.ogimage || data.ogImageFallback} />
  <!-- ðŸŽ… // Favicon need more control too -->
  <link rel="icon" type="image/png" href="/favicon/favicon.png" />
  <!-- ðŸŽ… // Schema.org -->
  {seo.schema && <script type="application/ld+json" set:html={seo.schema} />}
  <!-- scripts -->
  <script src="../scripts/cat.js"></script>
  <script src="https://getinsights.io/js/insights.js"></script>
  <script>
    insights.init("jG7sYwBlh_ch4ulL");
    insights.trackPages();
  </script>
</head>
